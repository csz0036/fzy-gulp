"use strict";var _createClass=function(){function i(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,a){return e&&i(t.prototype,e),a&&i(t,a),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t){var e=function(){function e(){_classCallCheck(this,e);var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.options={el:document.querySelector("body"),mode:"default",time:300,done:!0,diy:{backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center center"},position:{top:0,right:0,bottom:0,left:0},before:function(t){},success:function(t){},error:function(t){}},Object.assign({},this.options,t),Object.assign({},this.options.diy,t.diy),Object.assign(this.options,t),this.canvas=document.createElement("canvas"),this.canvas.getContext("2d").globalAlpha=0,this.images={},this._timer=!0,this.start()}return _createClass(e,[{key:"_testMeet",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=t.getBoundingClientRect(),i=t.offsetWidth,n=t.offsetHeight,r=window.innerWidth,s=window.innerHeight,o=!(a.right-e.left<=0&&a.left+i-e.left<=0||a.left+e.right>=r&&a.right+e.right>=i+r),c=!(a.bottom-e.top<=0&&a.top+n-e.top<=0||a.top+e.bottom>=s&&a.bottom+e.bottom>=n+s);return 0!==t.width&&0!==t.height&&o&&c}},{key:"_getTransparent",value:function(t,e,a){if(this.images[t])return this.images[t];this.canvas.width=e,this.canvas.height=a;var i=this.canvas.toDataURL("image/png");return this.images[t]=i}},{key:"start",value:function(){var e=this,a=this.options;clearTimeout(this._timer),this._timer&&(this._timer=setTimeout(function(){var t=Array.prototype.slice.apply(a.el.querySelectorAll("[data-src]"));!t.length&&a.done?clearTimeout(e._timer):t.forEach(function(t){!t.dataset.LazyLoadImgState&&e._testMeet(t,a.position)&&e.loadImg(t)}),e.start()},a.time))}},{key:"loadImg",value:function(t){var e=this,a=this.options;t.dataset.LazyLoadImgState="start",a.before.call(this,t);var i=new window.Image;i.src=t.dataset.src,i.addEventListener("load",function(){return"diy"===a.mode?(t.src=e._getTransparent(t.src,t.width,t.height),a.diy.backgroundImage="url("+i.src+")",Object.assign(t.style,a.diy)):t.src=i.src,delete t.dataset.src,t.dataset.LazyLoadImgState="success",a.success.call(e,t)},!1),i.addEventListener("error",function(){delete t.dataset.src,t.dataset.LazyLoadImgState="error",a.error.call(e,t)},!1)}},{key:"destroy",value:function(){delete this._timer}},{key:"restart",value:function(){this._timer=!0,this.start()}}]),e}();t.LazyLoadImg=e}(window);